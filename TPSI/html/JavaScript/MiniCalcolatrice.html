<!DOCTYPE html>
<html>
        <head><title>CALCOLA NUMERI</title>
            <link rel="stylesheet" href="../CSS/MiniCalcolatrice.CSS">
            <script>

                function TasterinoNumerico() {
                    document.getElementById("Display").focus();
                }

                

                function PuntoDopo3Numeri() {
                    const risultato = document.getElementById("Risultato").innerText;
                    const parts = risultato.split(/[\+\-\*\/]/);
                    const lastPart = parts[parts.length - 1];
                    if (lastPart.length === 3 && !lastPart.includes('.')) {
                        document.getElementById("Risultato").innerText += '.';
                    }
                }

                function AggiungiNumero(num) {
                    document.getElementById("Risultato").innerText += num;
                    const risultato = document.getElementById("Risultato").innerText;
                    const lastChar = risultato.charAt(risultato.length - 1);
                    // Controlla se l'ultimo carattere è un punto decimale
                    if (lastChar === '.') {
                        // Verifica se c'è già un punto decimale nell'ultima parte del numero
                        const parts = risultato.split(/[\+\-\*\/]/);
                        const lastPart = parts[parts.length - 1];
                        if ((lastPart.match(/\./g) || []).length > 1) {
                            // Rimuovi l'ultimo punto decimale aggiunto
                            document.getElementById("Risultato").innerText = risultato.slice(0, -1);
                        }
                    }
                }

                function AggiungiOperatore(op) {
                    const risultato = document.getElementById("Risultato").innerText;
                    const lastChar = risultato.charAt(risultato.length - 1);
                    if ("+-*/".includes(lastChar)) {
                        // Sostituisci l'operatore se l'ultimo carattere è già un operatore
                        document.getElementById("Risultato").innerText = risultato.slice(0, -1) + op;
                    } else {
                        document.getElementById("Risultato").innerText += op;
                    }
                }

                function Pulisci() {
                    document.getElementById("Risultato").innerText = "";
                }

                function Calcola() {
                    const espressione = document.getElementById("Risultato").innerText;
                    try {
                        const risultato = eval(espressione);
                        document.getElementById("Risultato").innerText = risultato;
                    } catch (e) {
                        document.getElementById("Risultato").innerText = "Errore";
                    }
                }

                // Keyboard handler: mappa i tasti fisici alle funzioni della calcolatrice
                document.addEventListener('DOMContentLoaded', function () {
                    document.addEventListener('keydown', function (e) {
                        const key = e.key;
                        const resEl = document.getElementById('Risultato');
                        if (!resEl) return;

                        // numeri 0-9
                        if (/^[0-9]$/.test(key)) {
                            e.preventDefault();
                            AggiungiNumero(key);
                            return;
                        }

                        // punto decimale
                        if (key === '.') {
                            e.preventDefault();
                            AggiungiNumero('.');
                            return;
                        }

                        // operatori
                        if (['+','-','*','/'].includes(key)) {
                            e.preventDefault();
                            AggiungiOperatore(key);
                            return;
                        }

                        // Enter -> calcola
                        if (key === 'Enter') { // "35" == 35  vero   "35" === 35 falso
                            e.preventDefault();
                            Calcola();
                            return;
                        }

                        // Backspace -> elimina ultimo carattere
                        if (key === 'Backspace') {
                            e.preventDefault();
                            const txt = resEl.innerText || '';
                            resEl.innerText = txt.slice(0, -1);
                            return;
                        }

                        // Escape o C -> pulisci
                        if (key === 'Escape' || key === 'c' || key === 'C') {
                            e.preventDefault();
                            Pulisci();
                            return;
                        }
                    });
                });
                
                function limiteNumeri(){
                    const risultato = document.getElementById("Risultato").innerText;
                    if (risultato.length >= 16) {
                        
                    }
                }

            </script>
        </head>
    <body>   
        <div id="Calcolatrice">
            <div id="Risultato">
                <input type="text" id="Display" onclick="TasterinoNumerico()">
            </div>
            <div id="Tasti">
                <input type="button" value="7" onclick="AggiungiNumero('7')" class="Button">
                <input type="button" value="8" onclick="AggiungiNumero('8')" class="Button">
                <input type="button" value="9" onclick="AggiungiNumero('9')" class="Button">
                <input type="button" value="/" onclick="AggiungiOperatore('/')" class="Button">
                <br>
                <input type="button" value="4" onclick="AggiungiNumero('4')" class="Button">
                <input type="button" value="5" onclick="AggiungiNumero('5')" class="Button">
                <input type="button" value="6" onclick="AggiungiNumero('6')" class="Button">
                <input type="button" value="*" onclick="AggiungiOperatore('*')" class="Button">
                <br>
                <input type="button" value="1" onclick="AggiungiNumero('1')" class="Button">
                <input type="button" value="2" onclick="AggiungiNumero('2')" class="Button">
                <input type="button" value="3" onclick="AggiungiNumero('3')" class="Button">
                <input type="button" value="-" onclick="AggiungiOperatore('-')" class="Button">
                <br>
                <input type="button" value="." onclick="AggiungiNumero('.')" class="Button">
                <input type="button" value="0" onclick="AggiungiNumero('0')" class="Button">
                <input type="button" value="C" onclick="Pulisci()" class="Button">
                <input type="button" value="+" onclick="AggiungiOperatore('+')" class="Button">
                <input type="button" value="=" onclick="Calcola()" class="Button">
            </div>
        </div>
    </body>
</html>

            